import{c as fe,u as se,L as Te,P as Ie,m as Ce,d as pe}from"./request-4f3541ce.js";import{c as Q,t as E,n as G,e as _,u as $e,N as me,O as de,Q as ze,R as Me,l as he,S as ce,T as F,p as V,U as D,w as ge,j as Xe,x as U,V as Ye,A as Ze,z as Re,h as re,m as ue,W as Ae,H as De,I as Ee,M as _e,f as Oe}from"./index-f7b1a7d1.js";import{O as J,u as K,z as ee,I as y,y as R,Z as ne,N as He,M as ke,$ as We,Q as S,G as le,a2 as we}from"./_plugin-vue_export-helper-4a308993.js";import{I as Ne}from"./index-23e5296c.js";import{c as Be}from"./interceptor-4f4458bc.js";const[Pe,j]=Q("swipe"),Le={loop:E,width:G,height:G,vertical:Boolean,autoplay:_(0),duration:_(500),touchable:E,lazyRender:Boolean,initialSwipe:_(0),indicatorColor:String,showIndicators:E,stopPropagation:E},ye=Symbol(Pe);var Fe=J({name:Pe,props:Le,emits:["change","dragStart","dragEnd"],setup(e,{emit:v,slots:d}){const t=K(),n=K(),o=ee({rect:null,width:0,height:0,offset:0,active:0,swiping:!1});let T=!1;const w=fe(),{children:g,linkChildren:u}=$e(ye),s=y(()=>g.length),f=y(()=>o[e.vertical?"height":"width"]),P=y(()=>e.vertical?w.deltaY.value:w.deltaX.value),b=y(()=>o.rect?(e.vertical?o.rect.height:o.rect.width)-f.value*s.value:0),z=y(()=>f.value?Math.ceil(Math.abs(b.value)/f.value):s.value),M=y(()=>s.value*f.value),X=y(()=>(o.active+s.value)%s.value),A=y(()=>{const i=e.vertical?"vertical":"horizontal";return w.direction.value===i}),c=y(()=>{const i={transitionDuration:`${o.swiping?0:e.duration}ms`,transform:`translate${e.vertical?"Y":"X"}(${o.offset}px)`};if(f.value){const h=e.vertical?"height":"width",m=e.vertical?"width":"height";i[h]=`${M.value}px`,i[m]=e[m]?`${e[m]}px`:""}return i}),Y=i=>{const{active:h}=o;return i?e.loop?D(h+i,-1,s.value):D(h+i,0,z.value):h},I=(i,h=0)=>{let m=i*f.value;e.loop||(m=Math.min(m,-b.value));let C=h-m;return e.loop||(C=D(C,b.value,0)),C},Z=({pace:i=0,offset:h=0,emitChange:m})=>{if(s.value<=1)return;const{active:C}=o,x=Y(i),N=I(x,h);if(e.loop){if(g[0]&&N!==b.value){const oe=N<b.value;g[0].setOffset(oe?M.value:0)}if(g[s.value-1]&&N!==0){const oe=N>0;g[s.value-1].setOffset(oe?-M.value:0)}}o.active=x,o.offset=N,m&&x!==C&&v("change",X.value)},O=()=>{o.swiping=!0,o.active<=-1?Z({pace:s.value}):o.active>=s.value&&Z({pace:-s.value})},te=()=>{O(),w.reset(),F(()=>{o.swiping=!1,Z({pace:-1,emitChange:!0})})},W=()=>{O(),w.reset(),F(()=>{o.swiping=!1,Z({pace:1,emitChange:!0})})};let B;const a=()=>clearTimeout(B),l=()=>{a(),e.autoplay>0&&s.value>1&&(B=setTimeout(()=>{W(),l()},+e.autoplay))},r=(i=+e.initialSwipe)=>{if(!t.value)return;const h=()=>{var m,C;if(!ce(t)){const x={width:t.value.offsetWidth,height:t.value.offsetHeight};o.rect=x,o.width=+((m=e.width)!=null?m:x.width),o.height=+((C=e.height)!=null?C:x.height)}s.value&&(i=Math.min(s.value-1,i),i===-1&&(i=s.value-1)),o.active=i,o.swiping=!0,o.offset=I(i),g.forEach(x=>{x.setOffset(0)}),l()};ce(t)?le().then(h):h()},p=()=>r(o.active);let $;const H=i=>{!e.touchable||i.touches.length>1||(w.start(i),T=!1,$=Date.now(),a(),O())},ae=i=>{e.touchable&&o.swiping&&(w.move(i),A.value&&(!e.loop&&(o.active===0&&P.value>0||o.active===s.value-1&&P.value<0)||(V(i,e.stopPropagation),Z({offset:P.value}),T||(v("dragStart"),T=!0))))},L=()=>{if(!e.touchable||!o.swiping)return;const i=Date.now()-$,h=P.value/i;if((Math.abs(h)>.25||Math.abs(P.value)>f.value/2)&&A.value){const C=e.vertical?w.offsetY.value:w.offsetX.value;let x=0;e.loop?x=C>0?P.value>0?-1:1:0:x=-Math[P.value>0?"ceil":"floor"](P.value/f.value),Z({pace:x,emitChange:!0})}else P.value&&Z({pace:0});T=!1,o.swiping=!1,v("dragEnd"),l()},Se=(i,h={})=>{O(),w.reset(),F(()=>{let m;e.loop&&i===s.value?m=o.active===0?0:i:m=i%s.value,h.immediate?F(()=>{o.swiping=!1}):o.swiping=!1,Z({pace:m-o.active,emitChange:!0})})},be=(i,h)=>{const m=h===X.value,C=m?{backgroundColor:e.indicatorColor}:void 0;return S("i",{style:C,class:j("indicator",{active:m})},null)},xe=()=>{if(d.indicator)return d.indicator({active:X.value,total:s.value});if(e.showIndicators&&s.value>1)return S("div",{class:j("indicators",{vertical:e.vertical})},[Array(s.value).fill("").map(be)])};return se({prev:te,next:W,state:o,resize:p,swipeTo:Se}),u({size:f,props:e,count:s,activeIndicator:X}),R(()=>e.initialSwipe,i=>r(+i)),R(s,()=>r(o.active)),R(()=>e.autoplay,l),R([me,de],p),R(ze(),i=>{i==="visible"?l():a()}),ne(r),He(()=>r(o.active)),Me(()=>r(o.active)),ke(a),We(a),he("touchmove",ae,{target:n}),()=>{var i;return S("div",{ref:t,class:j()},[S("div",{ref:n,style:c.value,class:j("track",{vertical:e.vertical}),onTouchstartPassive:H,onTouchend:L,onTouchcancel:L},[(i=d.default)==null?void 0:i.call(d)]),xe()])}}});const Ue=ge(Fe),[je,Ve]=Q("swipe-item");var qe=J({name:je,setup(e,{slots:v}){let d;const t=ee({offset:0,inited:!1,mounted:!1}),{parent:n,index:o}=Xe(ye);if(!n)return;const T=y(()=>{const u={},{vertical:s}=n.props;return n.size.value&&(u[s?"height":"width"]=`${n.size.value}px`),t.offset&&(u.transform=`translate${s?"Y":"X"}(${t.offset}px)`),u}),w=y(()=>{const{loop:u,lazyRender:s}=n.props;if(!s||d)return!0;if(!t.mounted)return!1;const f=n.activeIndicator.value,P=n.count.value-1,b=f===0&&u?P:f-1,z=f===P&&u?0:f+1;return d=o.value===f||o.value===b||o.value===z,d}),g=u=>{t.offset=u};return ne(()=>{le(()=>{t.mounted=!0})}),se({setOffset:g}),()=>{var u;return S("div",{class:Ve(),style:T.value},[w.value?(u=v.default)==null?void 0:u.call(v):null])}}});const Ge=ge(qe),ve=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),ie=Q("image-preview")[1];var Ke=J({props:{src:String,show:Boolean,active:Number,minZoom:U(G),maxZoom:U(G),rootWidth:U(Number),rootHeight:U(Number),disableZoom:Boolean},emits:["scale","close","longPress"],setup(e,{emit:v,slots:d}){const t=ee({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),n=fe(),o=K(),T=y(()=>{const{rootWidth:a,rootHeight:l}=e,r=l/a;return t.imageRatio>r}),w=y(()=>{const{scale:a,moveX:l,moveY:r,moving:p,zooming:$}=t,H={transitionDuration:$||p?"0s":".3s"};if(a!==1){const ae=l/a,L=r/a;H.transform=`scale(${a}, ${a}) translate(${ae}px, ${L}px)`}return H}),g=y(()=>{if(t.imageRatio){const{rootWidth:a,rootHeight:l}=e,r=T.value?l/t.imageRatio:a;return Math.max(0,(t.scale*r-a)/2)}return 0}),u=y(()=>{if(t.imageRatio){const{rootWidth:a,rootHeight:l}=e,r=T.value?l:a*t.imageRatio;return Math.max(0,(t.scale*r-l)/2)}return 0}),s=a=>{a=D(a,+e.minZoom,+e.maxZoom+1),a!==t.scale&&(t.scale=a,v("scale",{scale:a,index:e.active}))},f=()=>{s(1),t.moveX=0,t.moveY=0},P=()=>{const a=t.scale>1?1:2;s(a),t.moveX=0,t.moveY=0};let b,z,M,X,A,c,Y,I=!1;const Z=a=>{const{touches:l}=a;if(b=l.length,b===2&&e.disableZoom)return;const{offsetX:r}=n;n.start(a),z=t.moveX,M=t.moveY,Y=Date.now(),I=!1,t.moving=b===1&&t.scale!==1,t.zooming=b===2&&!r.value,t.zooming&&(X=t.scale,A=ve(a.touches))},O=a=>{const{touches:l}=a;if(n.move(a),t.moving){const{deltaX:r,deltaY:p}=n,$=r.value+z,H=p.value+M;if(($>g.value||$<-g.value)&&!I){t.moving=!1;return}I=!0,V(a,!0),t.moveX=D($,-g.value,g.value),t.moveY=D(H,-u.value,u.value)}if(t.zooming&&(V(a,!0),l.length===2)){const r=ve(l),p=X*r/A;s(p)}},te=()=>{if(b>1)return;const{offsetX:a,offsetY:l}=n,r=Date.now()-Y,p=250,$=5;a.value<$&&l.value<$&&(r<p?c?(clearTimeout(c),c=null,P()):c=setTimeout(()=>{v("close"),c=null},p):r>Ye&&v("longPress"))},W=a=>{let l=!1;(t.moving||t.zooming)&&(l=!0,t.moving&&z===t.moveX&&M===t.moveY&&(l=!1),a.touches.length||(t.zooming&&(t.moveX=D(t.moveX,-g.value,g.value),t.moveY=D(t.moveY,-u.value,u.value),t.zooming=!1),t.moving=!1,z=0,M=0,X=1,t.scale<1&&f(),t.scale>e.maxZoom&&(t.scale=+e.maxZoom))),V(a,l),te(),n.reset()},B=a=>{const{naturalWidth:l,naturalHeight:r}=a.target;t.imageRatio=r/l};return R(()=>e.active,f),R(()=>e.show,a=>{a||f()}),he("touchmove",O,{target:y(()=>{var a;return(a=o.value)==null?void 0:a.$el})}),()=>{const a={loading:()=>S(Te,{type:"spinner"},null)};return S(Ge,{ref:o,class:ie("swipe-item"),onTouchstartPassive:Z,onTouchend:W,onTouchcancel:W},{default:()=>[d.image?S("div",{class:ie("image-wrap")},[d.image({src:e.src})]):S(Ne,{src:e.src,fit:"contain",class:ie("image",{vertical:T.value}),style:w.value,onLoad:B},a)]})}}});const[Qe,k]=Q("image-preview"),Je=["show","teleport","transition","overlayStyle","closeOnPopstate"],et={show:Boolean,loop:E,images:Re(),minZoom:_(1/3),maxZoom:_(3),overlay:E,closeable:Boolean,showIndex:E,className:re,closeIcon:ue("clear"),transition:String,beforeClose:Function,overlayClass:re,overlayStyle:Object,swipeDuration:_(300),startPosition:_(0),showIndicators:Boolean,closeOnPopstate:E,closeIconPosition:ue("top-right"),teleport:[String,Object]};var tt=J({name:Qe,props:et,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:v,slots:d}){const t=K(),n=ee({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),o=()=>{if(t.value){const c=Ae(t.value.$el);n.rootWidth=c.width,n.rootHeight=c.height,t.value.resize()}},T=c=>v("scale",c),w=c=>v("update:show",c),g=()=>{Be(e.beforeClose,{args:[n.active],done:()=>w(!1)})},u=c=>{c!==n.active&&(n.active=c,v("change",c))},s=()=>{if(e.showIndex)return S("div",{class:k("index")},[d.index?d.index({index:n.active}):`${n.active+1} / ${e.images.length}`])},f=()=>{if(d.cover)return S("div",{class:k("cover")},[d.cover()])},P=()=>{n.disableZoom=!0},b=()=>{n.disableZoom=!1},z=()=>S(Ue,{ref:t,lazyRender:!0,loop:e.loop,class:k("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:u,onDragEnd:b,onDragStart:P},{default:()=>[e.images.map((c,Y)=>S(Ke,{src:c,show:e.show,active:n.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:n.rootWidth,rootHeight:n.rootHeight,disableZoom:n.disableZoom,onScale:T,onClose:g,onLongPress:()=>v("longPress",{index:Y})},{image:d.image}))]}),M=()=>{if(e.closeable)return S(Ee,{role:"button",name:e.closeIcon,class:[k("close-icon",e.closeIconPosition),De],onClick:g},null)},X=()=>v("closed"),A=(c,Y)=>{var I;return(I=t.value)==null?void 0:I.swipeTo(c,Y)};return se({swipeTo:A}),ne(o),R([me,de],o),R(()=>e.startPosition,c=>u(+c)),R(()=>e.show,c=>{const{images:Y,startPosition:I}=e;c?(u(+I),le(()=>{o(),A(+I,{immediate:!0})})):v("close",{index:n.active,url:Y[n.active]})}),()=>S(Ie,we({class:[k(),e.className],overlayClass:[k("overlay"),e.overlayClass],onClosed:X,"onUpdate:show":w},Ze(e,Je)),{default:()=>[M(),z(),s(),f()]})}});let q;const at={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function ot(){({instance:q}=Ce({setup(){const{state:e,toggle:v}=pe(),d=()=>{e.images=[]};return()=>S(tt,we(e,{onClosed:d,"onUpdate:show":v}),null)}}))}const rt=(e,v=0)=>{if(_e)return q||ot(),e=Array.isArray(e)?{images:e,startPosition:v}:e,q.open(Oe({},at,e)),q};export{Ge as S,Ue as a,rt as s};
