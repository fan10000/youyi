import{_ as V}from"./CpPaySheet-93ad77aa.js";import{_ as k}from"./CpNavBar-ea159524.js";import{_ as D}from"./avatar-doctor-f51aff84.js";import{r as g}from"./index-5f55da43.js";import{f as $}from"./user-15b71d69.js";import{h as N,C as O}from"./consult-7375c68e.js";import{e as U,o as R}from"./vue-router-fd42b9e3.js";import{b as E,s as G}from"./function-call-4bcc473f.js";import"./index-27be5ca8.js";import{S as K}from"./index-dd751e82.js";import{O as L,u as n,Z as M,o as Q,R as W,Q as e,S as a,T as X,U as f,K as Y,W as Z,ab as j,X as q,Y as z,_ as A}from"./_plugin-vue_export-helper-4a308993.js";import{C as F}from"./index-93886e3d.js";import{C as H}from"./index-7ca2e351.js";import{C as J}from"./index-009019c7.js";import{s as tt}from"./request-4f3541ce.js";import"./CpIcon-56491ba7.js";import"./index-f7b1a7d1.js";import"./index-a2a726fb.js";import"./use-route-27c093b5.js";import"./use-placeholder-ca8c31e0.js";import"./index-470ccc52.js";import"./interceptor-4f4458bc.js";const m=c=>(q("data-v-78c694cc"),c=c(),z(),c),et={key:0,class:"consult-pay-page"},at={class:"pay-info"},ot={class:"tit"},st=m(()=>a("img",{class:"img",src:D,alt:""},null,-1)),lt=m(()=>a("p",{class:"desc"},[a("span",null,"极速问诊"),a("span",null,"自动分配医生")],-1)),nt=m(()=>a("div",{class:"pay-space"},null,-1)),ut={class:"pay-schema"},ct=m(()=>a("span",{class:"text"},"支付协议",-1)),rt=L({__name:"ConsultPay",setup(c){const t=U(),o=n(),b=async()=>{const s=await N({type:t.consult.type,illnessType:t.consult.illnessType});o.value=s.data,t.setCoupon(s.data.couponId)},r=n(),I=async()=>{if(t.consult.patientId){const s=await $(t.consult.patientId);r.value=s.data}};M(()=>{if(!t.consult.type||!t.consult.illnessType||!t.consult.depId||!t.consult.patientId)return E({title:"温馨提示",message:"问诊信息不完整请重新填写，如有未支付的问诊订单可在问诊记录中继续支付",closeOnPopstate:!1}).then(()=>{g.push("/")});b(),I()});const _=n(!1),d=n(!1),v=n(!1),p=n(""),x=async()=>{if(!_.value)return tt("请勾选我已同意支付协议");v.value=!0;const s=await O(t.consult);p.value=s.data.id,v.value=!1,t.clear(),d.value=!0};R(()=>{if(p.value)return!1});const w=()=>G({title:"关闭支付",message:"取消支付将无法获得医生回复，医生接诊名额有限，是否确认关闭？",cancelButtonText:"仍要关闭",confirmButtonText:"继续支付",confirmButtonColor:"var(--cp-primary)"}).then(()=>!1).catch(()=>(p.value="",g.push("/user/consult"),!0));return(s,i)=>{const P=k,u=F,y=H,B=J,S=K,T=V;return o.value?(Q(),W("div",et,[e(P,{title:"支付"}),a("div",at,[a("p",ot,"图文问诊 "+X(o.value.payment)+" 元",1),st,lt]),e(y,null,{default:f(()=>[e(u,{title:"优惠券",value:`- ¥ ${o.value.couponDeduction}`},null,8,["value"]),e(u,{title:"积分抵扣",value:`- ¥ ${o.value.pointDeduction}`},null,8,["value"]),e(u,{title:"实付款",value:`- ¥ ${o.value.actualPayment}`,class:"pay-price"},null,8,["value"])]),_:1}),nt,e(y,null,{default:f(()=>{var l,h,C;return[e(u,{title:"患者信息",value:`${(l=r.value)==null?void 0:l.name} | ${(h=r.value)==null?void 0:h.genderValue} | ${(C=r.value)==null?void 0:C.age}岁`},null,8,["value"]),e(u,{title:"病情描述",label:Y(t).consult.illnessDesc},null,8,["label"])]}),_:1}),a("div",ut,[e(B,{modelValue:_.value,"onUpdate:modelValue":i[0]||(i[0]=l=>_.value=l)},{default:f(()=>[Z("我已同意"),ct]),_:1},8,["modelValue"])]),e(S,{"button-type":"primary",price:o.value.actualPayment*100,"button-text":"立即支付","text-align":"left",loading:v.value,onClick:x},null,8,["price","loading"]),e(T,{"actual-payment":o.value.actualPayment,show:d.value,"onUpdate:show":i[1]||(i[1]=l=>d.value=l),orderId:p.value,onClose:w,payCallback:"/room"},null,8,["actual-payment","show","orderId"])])):j("",!0)}}});const $t=A(rt,[["__scopeId","data-v-78c694cc"]]);export{$t as default};
